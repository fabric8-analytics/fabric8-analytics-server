"""Approved licenses for redistribution
"""

#===================
# Approved lists from Fedora wiki (not currently used - see next section)
SOFTWARE=["Glide", "ASL 1.1", "Abstyles", "AFL", "AMPAS BSD", "Adobe", "APAFML", "MIT", "AGPLv1", "AGPLv3", "AGPLv3+", "AGPLv3 with exceptions", "Afmparse", "ADSL", "AMDPLPA", "ASL 1.0", "ASL 1.1", "ASL 2.0", "App-s2p", "AML", "APSL 2.0", "Artistic clarified", "Artistic 2.0", "ARL", "AAL", "Bahyph", "Barr", "Beerware", "BeOpen", "Bibtex", "BitTorrent", "Boost", "Borceux", "BSD with advertising", "BSD with attribution", "BSD", "BSD", "BSD Protection", "CATOSL", "CeCILL", "CeCILL", "CeCILL-B", "CeCILL-C", "Netscape", "MIT", "CNRI", "CDDL", "CPL", "Condor", "Copyright only", "CPAL", "CRC32", "BSD", "GPLv2+", "LGPLv2+", "CC0", "Crossword", "BSD", "Crystal Stacker", "MPLv1.1", "Cube", "diffmark", "WTFPL", "DOC", "DMIT", "Dotseqn", "DSDP", "dvipdfm", "BSD", "EPL", "eCos", "ECL 1.0", "ECL 2.0", "eGenix", "EFL 2.0", "MIT", "MIT with advertising", "Entessa", "EPICS", "ERPL", "EU Datagrid", "EUPL 1.1", "Eurosym", "GPLv2 with exceptions", "Fair", "MIT", "LGPLv2 with exceptions", "MPLv1.0", "FTL", "FSFUL", "FSFULLR", "Giftware", "GL2PS", "Glulxe", "GPL+", "GPL+ with exceptions", "GPL+ with exceptions", "GPLv1", "GPL+", "GPLv2", "GPLv2 with exceptions", "GPLv2 with exceptions", "GPLv2+", "GPLv2+ with exceptions", "GPLv2+ with exceptions", "GPLv3", "GPLv3 with exceptions", "GPLv3 with exceptions", "GPLv3+", "GPLv3+ with exceptions", "GPLv3+ with exceptions", "LGPLv2+", "LGPLv2", "LGPLv2 with exceptions", "LGPLv2+", "LGPLv2+ with exceptions", "LGPLv3", "LGPLv3 with exceptions", "LGPLv3+", "LGPLv3+ with exceptions", "gnuplot", "HaskellReport", "HSRL", "MIT", "IBM", "iMatix", "ImageMagick", "Imlib2", "IJG", "Intel ACPI", "Interbase", "ISC", "Jabber", "JasPer", "JPython", "Julius", "Knuth", "LPPL", "Latex2e", "LBNL BSD", "LOSLA", "Leptonica", "Lhcyr", "libtiff", "LLGPL", "Logica", "LPL", "MakeIndex", "MTLL", "mecab-ipadic", "BSD", "MS-PL", "MS-RL", "midnight", "MirOS", "MIT", "MITNFA", "mod_macro", "Motosoto", "MPLv1.0", "MPLv1.1", "MPLv2.0", "MIT", "Mup", "ASL 1.1", "GPLv2 with exceptions", "Naumen", "NCSA", "ASL 1.1", "NetCDF", "NGPL", "NOSL", "Netscape", "Newmat", "Newsletr", "Nmap", "Nokia", "NLPL", "Noweb", "BSD with advertising", "MIT with advertising", "OGL", "OpenLDAP", "OML", "OpenPBS", "OSL 1.0", "OSL 1.1", "OSL 2.0", "OSL 2.1", "OSL 3.0", "OpenSSL", "OReilly", "Par", "GPL+ or Artistic", "GPLv2 or Artistic", "GPLv2+ or Artistic", "LGPLv2+ or Artistic", "Phorum", "PHP", "PlainTeX", "Plexus", "PostgreSQL", "psfrag", "psutils", "Public Domain", "Python", "Qhull", "QPL", "LGPLv2+ with exceptions", "ASL 1.1", "Rdisc", "RPSL", "REX", "RiceBSD", "Romio", "Rsfs", "Ruby", "Saxpath", "Sequence", "SCEA", "SWL", "STMPL", "SCRIP", "Sendmail", "MIT", "Sleepycat", "SLIB", "softSurfer", "SNIA", "MIT", "SISSL", "SPL", "TCL", "Teeworlds", "TTWL", "TPL", "Threeparttable", "TPDL", "TMate", "Tolua", "TORQUEv1.1", "TGPPL", "TOSL", "UCD", "Unicode", "Unlicense", "Vim", "VNLSL", "VOSTROM", "VSL", "W3C", "Webmin", "Wsuipa", "wxWidgets", "xinetd", "Xerox", "xpp", "XSkat", "YPLv1.1", "Zed", "Zend", "ZPLv1.0", "ZPLv2.0", "ZPLv2.1", "zlib", "zlib with acknowledgement"]

DOCUMENTATION=["CDL", "CC-BY", "CC-BY-SA", "FBSDDL", "GFDL", "IEEE", "LDPL", "OFSFDL", "Open Publication", "Public Use", "Verbatim"]

CONTENT=["CC-BY", "CC-BY-SA", "CC-BY-ND", "CC0", "DSL", "DMTF", "OAL", "EFML", "Free Art", "GeoGratis", "Green OpenMusic", "BSD with advertising"]

FONTS=["OFL", "Utopia", "AMS", "Arphic", "Baekmuk", "Bitstream Vera", "Charter", "CC-BY", "DoubleStroke", "ec", "Elvish", "LPPL", "Hershey", "IPA", "Liberation", "LPPL", "Lucida", "MgOpen", "mplus", "PTFL", "Punknova", "STIX", "Wadalab", "XANO"]
#===================

#===================
# Auto-generated list of licenses approved by Red Hat
# Distinct licenses recognised: 235
# License variants recognised: 289
# Approved licenses: 235
# Disapproved licenses: 0
APPROVED = [
    'AAL',                    # aal
    'ADSL',                   # adsl
    'AFL',                    # afl
    'AMDPLPA',                # amdplpa
    'AML',                    # aml
    'AMPAS BSD',              # ampas-bsd
    'AMS',                    # ams
    'APAFML',                 # apafml
    'APSL 2.0',               # apsl-2.0,apsl-2.0-s
    'ARL',                    # arl
    'ASL 1.0',                # asl-1.0
    'ASL 1.1',                # asl-1.1,mx4j,clearsilver,quickfix
    'ASL 2.0',                # asl-2.0,asl-2.0-s
    'Abstyles',               # abstyles
    'Adobe',                  # adobe
    'Afmparse',               # afmparse
    'App-s2p',                # app-s2p
    'Arphic',                 # arphic
    'Artistic 2.0',           # artistic-2.0
    'Artistic clarified',     # artistic-clarified
    'BSD',                    # bsd-3-clause,bsd-2-clause-freebsd,bsd-2-clause,cryptix,edl-1.0,bsd-metaspliot-framework
    'BSD Protection',         # bsd-protection
    'BSD with advertising',   # bsd-with-advertising,nrl,bsd-opendata
    'BSD with attribution',   # bsd-with-attribution
    'Baekmuk',                # baekmuk
    'Bahyph',                 # bahyph
    'Barr',                   # barr
    'BeOpen',                 # beopen
    'Beerware',               # beerware
    'BitTorrent',             # bittorrent,bittorrent-s
    'Bitstream Vera',         # bitstream-vera
    'Boost',                  # boost
    'Borceux',                # borceux
    'CATOSL',                 # catosl-1.1
    'CC-BY',                  # cc-by-3.0
    'CC-BY-ND',               # cc-by-nd-3.0
    'CC-BY-SA',               # cc-by-sa-3.0
    'CC0',                    # cc0-1.0
    'CDDL',                   # cddl
    'CDL',                    # cdl-1.0,cdl-1.0-s
    'CNRI',                   # cnri
    'CPAL',                   # cpal,cpal-s
    'CPL',                    # cpl
    'CRC32',                  # crc32
    'CeCILL',                 # cecill-1.1,cecill-2.0
    'CeCILL-B',               # cecill-b
    'CeCILL-C',               # cecill-c
    'Charter',                # charter
    'Crossword',              # crossword
    'Crystal Stacker',        # crystal-stacker
    'Cube',                   # cube
    'DMIT',                   # dmit
    'DMTF',                   # dmtf
    'DOC',                    # doc
    'DSDP',                   # dsdp
    'DSL',                    # dsl
    'Dotseqn',                # dotseqn
    'DoubleStroke',           # doublestroke
    'ECL 1.0',                # ecl-1.0
    'ECL 2.0',                # ecl-2.0,ecl-2.0-s
    'EFL 2.0',                # efl-2.0
    'EFML',                   # efml
    'EPICS',                  # epics
    'EPL',                    # epl-1.0
    'ERPL',                   # erlpl-1.1,erlpl-1.1-s
    'EU Datagrid',            # eudatagrid
    'EUPL 1.1',               # eupl-1.1
    'Elvish',                 # elvish
    'Entessa',                # entessa
    'Eurosym',                # eurosym
    'FBSDDL',                 # fbsddl
    'FSFUL',                  # fsful
    'FSFULLR',                # fsfullr
    'FTL',                    # ftl
    'Fair',                   # fair
    'Forbidden Phrase',       # license-f,copyright-f
    'Free Art',               # fal-1.3,fal-1.3-s
    'GFDL',                   # gfdl-1.3
    'GL2PS',                  # gl2ps
    'GPL+ or Artistic',       # artistic-perl
    'GPLv1',                  # gpl-1.0,gpl-1.0-s
    'GPLv2',                  # gpl-2.0,gpl-2.0-s
    'GPLv2 with exceptions',  # gpl-2.0-with-classpath-exception,gpl-2.0-with-font-exception
    'GPLv3',                  # gpl-3.0,gpl-3.0-s
    'Giftware',               # giftware
    'Glide',                  # glide
    'Glulxe',                 # glulxe
    'Green OpenMusic',        # green-openmusic
    'HSRL',                   # hsrl
    'HaskellReport',          # haskellreport
    'Hershey',                # hershey
    'IBM',                    # ipl-1.0
    'IEEE',                   # ieee
    'IJG',                    # ijg
    'IPA',                    # ipa
    'ISC',                    # isc
    'ImageMagick',            # imagemagick,imagemagick-s
    'Imlib2',                 # imlib2
    'Intel ACPI',             # intel-acpi
    'Jabber',                 # jabber,jabber-s
    'JasPer',                 # jasper-2.0
    'Julius',                 # julius
    'LBNL BSD',               # bsd-lnbl
    'LDPL',                   # ldpl-2.0,ldpl-2.0-s
    'LGPLv2',                 # lgpl-2.1,lgpl-2.1-s
    'LGPLv2+ with exceptions', # qwt-1.0
    'LGPLv3',                 # lgpl-3.0
    'LLGPL',                  # llgpl
    'LOSLA',                  # losla,losla-s
    'LPL',                    # lpl-1.02
    'LPPL',                   # lppl-1.3a,gust,lppl-1.3a-s
    'Latex2e',                # latex2e
    'Leptonica',              # leptonica
    'Lhcyr',                  # lhcyr
    'Liberation',             # liberation
    'Lucida',                 # lucida,lucida-s
    'MIT',                    # mit-adobeglyph,mit-cmu,mit-enna,mit-feh,hpnd,mit-mpich2,sgi-b-2.0,mit-standard-ml-of-new-jersey
    'MIT with advertising',   # mit-with-advertising,nunit
    'MITNFA',                 # mitnfa
    'MPLv1.0',                # freeimage,mpl-1.0,freeimage-s,mpl-1.0-s
    'MPLv1.1',                # cua-opl-1.0,mpl-1.1,cua-opl-1.0-s,mpl-1.1-s
    'MPLv2.0',                # mpl-2.0,mpl-2.0-s
    'MS-PL',                  # ms-pl
    'MS-RL',                  # ms-rl
    'MTLL',                   # mtll
    'MakeIndex',              # makeindex
    'MgOpen',                 # mgopen
    'MirOS',                  # miros
    'Motosoto',               # motosoto
    'Mup',                    # mup
    'NCSA',                   # ncsa
    'NGPL',                   # ngpl
    'NLPL',                   # nlpl
    'NOSL',                   # nosl,nosl-s
    'Naumen',                 # naumen
    'NetCDF',                 # netcdf
    'Netscape',               # npl-1.0,npl-1.0-s
    'Newmat',                 # newmat
    'Newsletr',               # newsletr
    'Nmap',                   # nmap
    'Nokia',                  # nokia,nokia-s
    'Noweb',                  # noweb
    'OAL',                    # oal-1.0.1
    'OFSFDL',                 # ofsfdl
    'OGL',                    # ogl
    'OML',                    # oml
    'OReilly',                # oreilly
    'OSL 1.0',                # osl-1.0
    'OSL 1.1',                # osl-1.1
    'OSL 2.0',                # osl-2.0
    'OSL 2.1',                # osl-2.1
    'OSL 3.0',                # osl-3.0
    'Open Publication',       # openpub-1.0
    'OpenLDAP',               # openldap
    'OpenPBS',                # openpbs
    'OpenSSL',                # openssl
    'PHP',                    # php-3.01
    'PTFL',                   # paratype
    'Par',                    # par
    'Phorum',                 # phorum
    'Plexus',                 # plexus
    'PostgreSQL',             # postgresql
    'Public Use',             # public-use-1.0
    'Punknova',               # punknova
    'Qhull',                  # qhull
    'REX',                    # rex
    'RPSL',                   # rpsl-1.0
    'Rdisc',                  # rdisc
    'RiceBSD',                # rice-bsd
    'Romio',                  # romio
    'Rsfs',                   # rsfs
    'Ruby',                   # ruby
    'SCEA',                   # scea
    'SCRIP',                  # scrip
    'SISSL',                  # sissl
    'SLIB',                   # slib
    'SNIA',                   # snia-1.1,snia-1.1-s
    'SPL',                    # spl,spl-s
    'STIX',                   # stix
    'STMPL',                  # stmpl,stmpl-s
    'SWL',                    # swl
    'Saxpath',                # saxpath
    'Sendmail',               # sendmail
    'Sequence',               # sequence
    'Sleepycat',              # sleepycat
    'TCL',                    # tcl
    'TGPPL',                  # tgppl
    'TMate',                  # tmate
    'TORQUEv1.1',             # torque-1.1
    'TOSL',                   # tosl
    'TPDL',                   # tpdl
    'TPL',                    # tpl,tpl-s
    'Teeworlds',              # teeworlds
    'Threeparttable',         # threeparttable
    'Tolua',                  # tolua
    'UCD',                    # ucd
    'Unicode',                # unicode
    'Unlicense',              # unlicense
    'Utopia',                 # utopia
    'VNLSL',                  # vnlsl
    'VOSTROM',                # vostrom
    'VSL',                    # vsl-1.0
    'Verbatim',               # verbatim
    'Vim',                    # vim
    'W3C',                    # w3c
    'WTFPL',                  # wtfpl
    'Wadalab',                # wadalab
    'Webmin',                 # webmin
    'Wsuipa',                 # wsuipa
    'XANO',                   # xano
    'XSkat',                  # xskat
    'Xerox',                  # xerox
    'YPLv1.1',                # ypl-1.1
    'ZPLv1.0',                # zpl-1.1
    'ZPLv2.0',                # zpl-2.0
    'ZPLv2.1',                # zpl-2.1
    'Zed',                    # zed
    'Zend',                   # zend-2.0
    'diffmark',               # diffmark
    'dvipdfm',                # dvipdfm
    'eCos',                   # ecos-2.0
    'eGenix',                 # egenix
    'ec',                     # ec
    'gnuplot',                # gnuplot
    'iMatix',                 # imatix
    'libtiff',                # libtiff
    'midnight',               # midnight
    'mplus',                  # mplus
    'psfrag',                 # psfrag
    'psutils',                # psutils
    'softSurfer',             # softsurfer
    'xinetd',                 # xinetd
    'xpp',                    # xpp
    'zlib',                   # zlib
    'zlib with acknowledgement', # zlib-acknowledgement
]
DISAPPROVED = [
]
#===================

APPROVED_LICENSES=set(APPROVED)
PROHIBITED_LICENSES=set(DISAPPROVED)

if __name__ == "__main__":
    # Helper script to generate the approved license list
    import json
    import sys
    from collections import defaultdict

    license_dump = sys.argv[1]
    with open(license_dump) as f:
        data = json.load(f)
    license_by_id = {entry["pk"]:entry["fields"]["short_name"]
                         for entry in data
                             if entry["model"] == "packages.license"}
    variants = [entry["fields"]
                         for entry in data
                             if entry["model"] == "packages.licensevariant"]
    approved = defaultdict(list)
    disapproved = defaultdict(list)
    for v in variants:
        target = approved if v["approved"] else disapproved
        target[license_by_id[v["license"]]].append(v["identifier"])
    # Check assumption that all variants of any given license are consistent
    ambiguous = set(approved) & set(disapproved)
    if ambiguous:
        print("Only some variants of these licenses are approved:")
        for license in ambiguous:
            print("  {}".format(license))
            print("    Approved: {}".format(", ".join(approved[license])))
            print("    Disapproved: {}".format(", ".join(approved[license])))
        sys.exit("Ambiguous licenses found")
    print("# Auto-generated list of licenses approved by Red Hat")
    print("# Distinct licenses recognised: {}".format(len(license_by_id)))
    print("# License variants recognised: {}".format(len(variants)))
    print("# Approved licenses: {}".format(len(approved)))
    print("# Disapproved licenses: {}".format(len(disapproved)))
    print("APPROVED = [")
    if approved:
        field_width = max(map(len, approved))
        for license, variants in sorted(approved.items()):
            quoted = "'{}',".format(license)
            variant_names = ",".join(variants)
            print("    {:{}} # {}".format(quoted, field_width, variant_names))
        print("]")
    print("DISAPPROVED = [")
    if disapproved:
        field_width = max(map(len, disapproved))
        for license, variants in sorted(disapproved.items()):
            quoted = "'{}',".format(license)
            variant_names = ",".join(variants)
            print("    {:{}} # {}".format(quoted, field_width, variant_names))
    print("]")
